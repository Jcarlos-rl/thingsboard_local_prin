{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "85832e00-cc2f-11ee-a15d-5578c62b7072"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "842ac9f0-cc2f-11ee-a15d-5578c62b7072"
    },
    "name" : "v3.Alarmas Voltaje-CorrienteV2",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 34,
      "type" : "True"
    }, {
      "fromIndex" : 1,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 3,
      "toIndex" : 25,
      "type" : "Failure"
    }, {
      "fromIndex" : 3,
      "toIndex" : 25,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 41,
      "type" : "Failure"
    }, {
      "fromIndex" : 3,
      "toIndex" : 41,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 48,
      "type" : "Failure"
    }, {
      "fromIndex" : 3,
      "toIndex" : 48,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 49,
      "type" : "Failure"
    }, {
      "fromIndex" : 3,
      "toIndex" : 49,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 4,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 5,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 5,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 6,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 7,
      "toIndex" : 9,
      "type" : "False"
    }, {
      "fromIndex" : 8,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 8,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 9,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 9,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 11,
      "toIndex" : 43,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 43,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 14,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 15,
      "toIndex" : 46,
      "type" : "Success"
    }, {
      "fromIndex" : 16,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 13,
      "type" : "True"
    }, {
      "fromIndex" : 18,
      "toIndex" : 11,
      "type" : "True"
    }, {
      "fromIndex" : 18,
      "toIndex" : 12,
      "type" : "False"
    }, {
      "fromIndex" : 18,
      "toIndex" : 21,
      "type" : "False"
    }, {
      "fromIndex" : 18,
      "toIndex" : 24,
      "type" : "True"
    }, {
      "fromIndex" : 20,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 20,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 21,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 22,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 3,
      "type" : "False"
    }, {
      "fromIndex" : 23,
      "toIndex" : 53,
      "type" : "True"
    }, {
      "fromIndex" : 24,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 24,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 25,
      "toIndex" : 19,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 26,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 27,
      "toIndex" : 1,
      "type" : "False"
    }, {
      "fromIndex" : 27,
      "toIndex" : 28,
      "type" : "True"
    }, {
      "fromIndex" : 29,
      "toIndex" : 40,
      "type" : "Success"
    }, {
      "fromIndex" : 30,
      "toIndex" : 31,
      "type" : "True"
    }, {
      "fromIndex" : 31,
      "toIndex" : 32,
      "type" : "Success"
    }, {
      "fromIndex" : 33,
      "toIndex" : 35,
      "type" : "Success"
    }, {
      "fromIndex" : 34,
      "toIndex" : 30,
      "type" : "Success"
    }, {
      "fromIndex" : 34,
      "toIndex" : 47,
      "type" : "Success"
    }, {
      "fromIndex" : 35,
      "toIndex" : 14,
      "type" : "False"
    }, {
      "fromIndex" : 35,
      "toIndex" : 36,
      "type" : "True"
    }, {
      "fromIndex" : 36,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 36,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 37,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 37,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 37,
      "toIndex" : 52,
      "type" : "Created"
    }, {
      "fromIndex" : 38,
      "toIndex" : 4,
      "type" : "False"
    }, {
      "fromIndex" : 38,
      "toIndex" : 39,
      "type" : "True"
    }, {
      "fromIndex" : 39,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 39,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 39,
      "toIndex" : 52,
      "type" : "Created"
    }, {
      "fromIndex" : 40,
      "toIndex" : 5,
      "type" : "False"
    }, {
      "fromIndex" : 40,
      "toIndex" : 26,
      "type" : "True"
    }, {
      "fromIndex" : 41,
      "toIndex" : 38,
      "type" : "Success"
    }, {
      "fromIndex" : 42,
      "toIndex" : 31,
      "type" : "True"
    }, {
      "fromIndex" : 44,
      "toIndex" : 0,
      "type" : "Created"
    }, {
      "fromIndex" : 44,
      "toIndex" : 0,
      "type" : "Updated"
    }, {
      "fromIndex" : 45,
      "toIndex" : 23,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 46,
      "toIndex" : 20,
      "type" : "False"
    }, {
      "fromIndex" : 46,
      "toIndex" : 44,
      "type" : "True"
    }, {
      "fromIndex" : 47,
      "toIndex" : 13,
      "type" : "True"
    }, {
      "fromIndex" : 48,
      "toIndex" : 6,
      "type" : "True"
    }, {
      "fromIndex" : 48,
      "toIndex" : 15,
      "type" : "True"
    }, {
      "fromIndex" : 48,
      "toIndex" : 16,
      "type" : "True"
    }, {
      "fromIndex" : 48,
      "toIndex" : 33,
      "type" : "True"
    }, {
      "fromIndex" : 49,
      "toIndex" : 50,
      "type" : "Success"
    }, {
      "fromIndex" : 50,
      "toIndex" : 29,
      "type" : "False"
    }, {
      "fromIndex" : 50,
      "toIndex" : 37,
      "type" : "True"
    }, {
      "fromIndex" : 50,
      "toIndex" : 51,
      "type" : "False"
    }, {
      "fromIndex" : 51,
      "toIndex" : 17,
      "type" : "Cleared"
    }, {
      "fromIndex" : 51,
      "toIndex" : 42,
      "type" : "Cleared"
    }, {
      "fromIndex" : 52,
      "toIndex" : 10,
      "type" : "True"
    }, {
      "fromIndex" : 53,
      "toIndex" : 22,
      "type" : "Failure"
    }, {
      "fromIndex" : 53,
      "toIndex" : 22,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 45,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1809,
        "layoutY" : 82
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return msg.startTs > 1;\n//return (msg.endTs - msg.startTs) > metadata.ss_aSENSIBILIDAD;",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84a1ceb0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Sensibilidad",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1333,
        "layoutY" : 797
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Desbalanceo corriente"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84a921b0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Desbalanceo corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2505,
        "layoutY" : 548
      },
      "configuration" : {
        "restEndpointUrlPattern" : "${ss_aBOT}",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "useRedisQueueForMsgPersistence" : false,
        "trimQueue" : false,
        "maxQueueSize" : 0,
        "credentials" : {
          "type" : "anonymous"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84aec700-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Telegraf",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 255,
        "layoutY" : 250
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "aVH", "aVL", "aFP", "aDELAY", "aIDESB", "aON", "aHISTERESIS", "aEMAIL", "aBOT", "aBOTON", "aBOTGROUP", "aSENSIBILIDAD", "aMUESTREO", "inicioalarma", "aIH", "aIL", "aSMSON", "aSMS", "aPTLTOKEN" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false,
        "fetchTo" : "METADATA"
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84b2e5b0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Limites",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1088,
        "layoutY" : 377
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Alto Voltaje"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84b77990-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alto Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1104,
        "layoutY" : 253
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Bajo voltaje"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84bea580-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 801,
        "layoutY" : 734
      },
      "configuration" : {
        "jsScript" : "if (msg.IDESB > metadata.ss_aIDESB)\n{\n    metadata.alarmatipo = \"Nivel de desbalanceo corriente alto\";\n    metadata.alarmadetalle = \"Nivel de desbalanceo corriente alto en dispositivo: \"+metadata.deviceName+\" || Valor: \"+msg.IDESB + \" % || Valor límite: \"+metadata.ss_aIDESB +\" %\";\n    metadata.alarma = 1;\n} else\n{\nmetadata.alarma = 0;\nmetadata.alarmatipo = \"Nivel de desbalanceo corriente en rangos normales\"\nmetadata.alarmadetalle = \"Nivel de desbalanceo en rangos normales en dispositivo: \" + metadata.deviceName +\" || Valor: \"+msg.IDESB + \" % || Valor límite: \"+metadata.ss_aIDESB +\" %\";\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84c3ae90-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Desbalanceo",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1063,
        "layoutY" : 655
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma === \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84c8b7a0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Factor Potencia Bajo",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1305,
        "layoutY" : 587
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Bajo factor potencia",
        "severity" : "MINOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84cfbc80-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Factor Potencia",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1302,
        "layoutY" : 656
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Bajo factor potencia"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84d33ef0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Factor Potencia",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2476,
        "layoutY" : 674
      },
      "configuration" : {
        "numbersToTemplate" : "+525555031316",
        "smsMessageTemplate" : "${alarmadetalle}",
        "useSystemSmsSettings" : true,
        "smsProviderConfiguration" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84d9cea0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "SMS",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.sms.TbSendSmsNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 981,
        "layoutY" : 1229
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msg = {};\nvar PTLdevice ={};\nmsg.aPE = 1;\nPTLdevice.deviceName = \"PTLv2\";\nPTLdevice.deviceType = \"PTL Profile\";\n//var NewmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: PTLdevice, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84dd9f30-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Estado PTL",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 984,
        "layoutY" : 1291
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msg = {};\nvar PTLdevice ={};\nmsg.aPE = 0;\nPTLdevice.deviceName = \"PTLv2\";\nPTLdevice.deviceType = \"PTL Profile\";\n//var NewmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: PTLdevice, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84e392a0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Estado PTL",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2494,
        "layoutY" : 426
      },
      "configuration" : {
        "jsScript" : "var newMsg ={};\nvar pasadotiempo = (msg.endTs - msg.startTs)/60000;\npasadotiempo = pasadotiempo.toFixed(2);\nnewMsg.text = \"Alarma tipo: \" + metadata.alarmatipo + \" || Detalle:\" + metadata.alarmadetalle + \" || Tiempo transcurrido: \" + pasadotiempo+\" minutos\";\nnewMsg.chat_id= metadata.ss_aBOTGROUP;\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84e9fb40-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Mensaje Telegraf",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1349,
        "layoutY" : 1004
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Alta Corriente"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "84efeeb0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alta Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 806,
        "layoutY" : 833
      },
      "configuration" : {
        "jsScript" : "if (msg.I1 > metadata.ss_aIH || msg.I2 > metadata.ss_aIH || msg.I3 > metadata.ss_aIH)\n            {\n                metadata.alarmatipo = \"Alto Corriente\";\n                metadata.alarmadetalle =\"Alto Corriente: \" + metadata.deviceName + \" || Valor límite: \"+metadata.ss_aIH+ \" A || Corrientes I1: \"+msg.I1+ \" / I2: \"+msg.I2+\" / I3: \"+msg.I3;\n            metadata.alarma = 1;\n            } else\n            {\n                metadata.alarma = 0;\n                metadata.alarmatipo = \"Ya no hay Alta Corriente\";\n                metadata.alarmadetalle = \"Ya no existe Alta Corriente: \" + metadata.deviceName + \" || Límite: \"+metadata.ss_aIH+ \" A || Corriente I1: \"+msg.I1+ \" / I2: \"+msg.I2+\" / I3: \"+msg.I3;\n            }\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8501f010-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alta Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 803,
        "layoutY" : 658
      },
      "configuration" : {
        "jsScript" : "if (msg.PFA < metadata.ss_aFP && msg.PFA > 0.1)\n{\n    metadata.alarmatipo = \"Factor de Potencia Bajo\";\n    metadata.alarmadetalle = \"Factor de Potencia Bajo en dispositivo: \"+metadata.deviceName+\" || Valor: \"+msg.PFA + \" % || Valor límite: \"+metadata.ss_aFP +\" %\";\n    metadata.alarma = 1;\n} else\n{\nmetadata.alarma = 0;\nmetadata.alarmatipo = \"Factor de Potencia en rangos normales\"\nmetadata.alarmadetalle = \"Factor de Potencia en rangos normales en dispositivo: \" + metadata.deviceName +\" || Valor: \"+msg.PFA + \" % || Valor límite: \"+metadata.ss_aFP +\" %\";\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8513ca60-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Factor Potencia Bajo",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2268,
        "layoutY" : 497
      },
      "configuration" : {
        "jsScript" : "return metadata.ss_aBOTON ==\"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "851996c0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Telegraf Clear Alarm",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 747,
        "layoutY" : 1152
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "851e0390-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Planta Encendida",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 797,
        "layoutY" : 423
      },
      "configuration" : {
        "restEndpointUrlPattern" : "http://tb03.tkmecloud.io/api/v1/${aPTLTOKEN}/telemetry",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "ignoreRequestBody" : null,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 10,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "useRedisQueueForMsgPersistence" : false,
        "trimQueue" : false,
        "maxQueueSize" : 0,
        "credentials" : {
          "type" : "anonymous"
        },
        "parseToPlainText" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85250870-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Crear PTL",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1379,
        "layoutY" : 894
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Alta Corriente"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85283cc0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alta Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1343,
        "layoutY" : 1182
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Planta Encendida"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "852b7110-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Planta Encendida",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 478,
        "layoutY" : 1156
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if ((msg.V1 > 110 || msg.V2 > 110 || msg.V3 > 110))\n{\n    if (metadata.deviceName === \"Planta de emergencia\")\n    {\n    metadata.alarmatipo = \"Planta Encendida\";\n    metadata.alarmadetalle = \"Planta Encendida Valores voltaje V1: \"+msg.V1+\" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n    metadata.alarma = 1;\n    }\n} else\n{\nmetadata.alarma = 0;\nmetadata.alarmatipo = \"Planta Apagada\";\nmetadata.alarmadetalle = \"La planta de emergencia se ha apagado \" + metadata.deviceName;\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85313d70-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Planta Encendida",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 144,
        "layoutY" : 461
      },
      "configuration" : {
        "messageNames" : [ "ESPLANTA" ],
        "metadataNames" : [ ],
        "checkAllKeys" : true
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "853498d0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "ES PLANTA EMERGENCIA",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbCheckMessageNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1337,
        "layoutY" : 1131
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Planta Encendida",
        "severity" : "MINOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8537f430-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Planta Encendida",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 522,
        "layoutY" : 435
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var EstadoPTL = {};\nEstadoPTL.vok = msg.vok;\nEstadoPTL.corte = msg.corte;\nvar msg = {};\nvar PTLdevice ={};\nif (EstadoPTL.vok == \"1\")\n{\n    if (metadata.deviceName == \"CFE\" )\n    {\n    msg.aCFE = 1;    \n    }\n    if (metadata.deviceName == \"Entrada UPS 1\" )\n    {\n    msg.aINUPS1 = 1;    \n    }\n    if (metadata.deviceName == \"Entrada UPS 2\" )\n    {\n    msg.aINUPS2 = 1;    \n    }\n    if (metadata.deviceName == \"Salida UPS 1\" )\n    {\n    msg.aOUTUPS1 = 1;    \n    }\n    if (metadata.deviceName == \"Salida UPS 2\" )\n    {\n    msg.aOUTUPS2 = 1;    \n    }    \n}\nif (EstadoPTL.corte == \"1\")\n{\n    if (metadata.deviceName == \"CFE\" )\n    {\n    msg.aCFE = 0;    \n    }\n    if (metadata.deviceName == \"Entrada UPS 1\" )\n    {\n    msg.aINUPS1 = 0;    \n    }\n    if (metadata.deviceName == \"Entrada UPS 2\" )\n    {\n    msg.aINUPS2 = 0;    \n    }\n    if (metadata.deviceName == \"Salida UPS 1\" )\n    {\n    msg.aOUTUPS1 = 0;    \n    }\n    if (metadata.deviceName == \"Salida UPS 2\" )\n    {\n    msg.aOUTUPS2 = 0;    \n    }    \n}\nPTLdevice.deviceName = \"PTLv2\";\nPTLdevice.deviceType = \"PTL Profile\";\nPTLdevice.aPTLTOKEN = metadata.ss_aPTLTOKEN;\n//var NewmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: PTLdevice, msgType: msgType};",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "853c8810-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Estado PTL",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1106,
        "layoutY" : 205
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Bajo voltaje",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85427b80-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1073,
        "layoutY" : 734
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma === \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8547aba0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Desbalanceo de Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1326,
        "layoutY" : 732
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Desbalanceo corriente",
        "severity" : "MAJOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "854ba340-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Desbalanceo corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 567,
        "layoutY" : 225
      },
      "configuration" : {
        "jsScript" : "if ((msg.V1 < metadata.ss_aVL || msg.V2 < metadata.ss_aVL || msg.V3 < metadata.ss_aVL) && (msg.V1 > 40 || msg.V2 > 40 || msg.V3 > 40))\n            {\n                metadata.alarmatipo = \"Bajo Voltaje\";\n                metadata.alarmadetalle =\"Bajo Voltaje en: \" + metadata.deviceName + \" || Umbral: \"+metadata.ss_aVL+ \" || Voltajes medidos: V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n            metadata.alarma = 1;\n            } else\n            {\n                metadata.alarma = 0;\n                metadata.alarmatipo = \"Ya no hay Bajo Voltaje\";\n                metadata.alarmadetalle = \"Ya no existe Bajo Voltaje en: \" + metadata.deviceName + \" || Valor límite: \"+metadata.ss_aVL+ \" || Voltajes medidos: V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n            }\n            \nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "854ed790-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2339,
        "layoutY" : 241
      },
      "configuration" : {
        "jsScript" : "return metadata.enviarcorreo == \"1\" && metadata.ss_aON ==\"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85528110-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Correo ALARM",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2417,
        "layoutY" : 134
      },
      "configuration" : {
        "fromTemplate" : "sender@tkmecloud.io",
        "toTemplate" : "${ss_aEMAIL}",
        "ccTemplate" : null,
        "bccTemplate" : null,
        "subjectTemplate" : "Dispositivo ${deviceName}:  ${alarmatipo} ",
        "bodyTemplate" : "El Dispositivo ${deviceName}. \nCondición:  ${alarmadetalle}."
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85569fc0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "${alarmadetalle}.",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2487,
        "layoutY" : 46
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "username" : null,
        "password" : null,
        "smtpProtocol" : "smtp",
        "timeout" : 10000,
        "enableTls" : false,
        "tlsVersion" : "TLSv1.2",
        "enableProxy" : false,
        "proxyHost" : null,
        "proxyPort" : null,
        "proxyUser" : null,
        "proxyPassword" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "855ba8d0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Envio de Correo",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 805,
        "layoutY" : 979
      },
      "configuration" : {
        "jsScript" : "if (msg.I1 < metadata.ss_aIL || msg.I2 < metadata.ss_aIL || msg.I3 < metadata.ss_aIL)\n            {\n                metadata.alarmatipo = \"Baja Corriente\";\n                metadata.alarmadetalle =\"Baja Corriente: \" + metadata.deviceName + \" || Valor límite: \"+metadata.ss_aIL+ \" A || Corrientes I1: \"+msg.I1+ \" / I2: \"+msg.I2+\" / I3: \"+msg.I3;\n            metadata.alarma = 1;\n            } else\n            {\n                metadata.alarma = 0;\n                metadata.alarmatipo = \"Ya no hay Baja Corriente\";\n                metadata.alarmadetalle = \"Ya no existe Baja Corriente: \" + metadata.deviceName + \" || Límite: \"+metadata.ss_aIL+ \" A || Corriente I1: \"+msg.I1+ \" / I2: \"+msg.I2+\" / I3: \"+msg.I3;\n            }\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85619c40-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Baja Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2031,
        "layoutY" : 157
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var deltatiempo = msg.endTs - msg.startTs;\n// dividir la variable modtiempo entre 60000 ms para 1 minuto retardo, 120,000 ms para dos minutos de retardo, etc.  Se usa el operador  \"%\"\nvar modtiempo = (deltatiempo % metadata.ss_aDELAY);\nmetadata.pasadotiempo = (deltatiempo / 60000);\nmetadata.pasadotiempo = metadata.pasadotiempo.toFixed(2);\nif (modtiempo < metadata.ss_aMUESTREO)  \n{\nmetadata.enviarcorreo = 1;\n} else\n{\nmetadata.enviarcorreo = 0;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n",
        "tbelScript" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85645b60-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Retardo Alertas",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1048,
        "layoutY" : 982
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8568a120-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Baja Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1334,
        "layoutY" : 958
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Alta Corriente",
        "severity" : "MAJOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "856b8750-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alta Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1129,
        "layoutY" : 23
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Corte Energia",
        "severity" : "CRITICAL",
        "propagate" : false,
        "relationTypes" : [ ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "856d8320-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Corte de Energía",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 785,
        "layoutY" : 325
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85704240-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alto Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1063,
        "layoutY" : 319
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Alto Voltaje",
        "severity" : "MAJOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8573c4b0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alto Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 834,
        "layoutY" : 229
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85759970-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Bajo Voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 527,
        "layoutY" : 324
      },
      "configuration" : {
        "jsScript" : "if ((msg.V1 > metadata.ss_aVH || msg.V2 > metadata.ss_aVH || msg.V3 > metadata.ss_aVH) && (msg.V1 > 40 || msg.V2 > 40 || msg.V3 > 40))\n            {\n                metadata.alarmatipo = \"Alto Voltaje\";\n                metadata.alarmadetalle =\"Alto Voltaje: \" + metadata.deviceName + \" || Umbral: \"+metadata.ss_aVH+ \" || Voltajes V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n            metadata.alarma = 1;\n            } else\n            {\n                metadata.alarma = 0;\n                metadata.alarmatipo = \"Ya no hay Alto Voltaje\";\n                metadata.alarmadetalle = \"Ya no existe Alto Voltaje: \" + metadata.deviceName + \" || Límite: \"+metadata.ss_aVH+ \" V || Voltajes V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n            }\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "857942f0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alto voltaje",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1998,
        "layoutY" : 247
      },
      "configuration" : {
        "jsScript" : "return metadata.ss_aON ==\"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "857c5030-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Correo Clear Alarm",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1288,
        "layoutY" : 1281
      },
      "configuration" : {
        "restEndpointUrlPattern" : "http://tb03.tkmecloud.io/api/v1/PTLConafor003/telemetry",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "ignoreRequestBody" : null,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "useRedisQueueForMsgPersistence" : false,
        "trimQueue" : false,
        "maxQueueSize" : 0,
        "credentials" : {
          "type" : "anonymous"
        },
        "parseToPlainText" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "857e4c00-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Crear PTL",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1365,
        "layoutY" : 845
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "useMessageAlarmData" : false,
        "alarmType" : "Alta Corriente",
        "severity" : "MAJOR",
        "propagate" : false,
        "relationTypes" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85813230-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alta Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 39,
        "layoutY" : 280
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85832e00-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Switch",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1048,
        "layoutY" : 846
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85861430-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Alto Corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2339,
        "layoutY" : 289
      },
      "configuration" : {
        "jsScript" : "return metadata.enviarcorreo == \"1\" && metadata.ss_aBOTON ==\"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85881000-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Telegraf ALARM",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 558,
        "layoutY" : 687
      },
      "configuration" : {
        "jsScript" : "return msg.IMAX > 0;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "858b4450-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Existen donas corriente",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 464,
        "layoutY" : 73
      },
      "configuration" : {
        "jsScript" : "if (msg.corte === 1 )\n        {\n            metadata.alarmatipo = \"Corte de Voltaje\" + metadata.deviceName;\n            metadata.alarmadetalle = \"Corte voltaje en:\" + metadata.deviceName+ \" Voltajes: V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n            metadata.alarma = 1;\n        } else\n        {\n            metadata.alarma = 0;\n            metadata.alarmatipo = \"Se ha restablecido voltaje\";\n            metadata.alarmadetalle = \"Ya no existe corte de voltaje en: \" + metadata.deviceName + \" Voltajes: V1: \"+msg.V1+ \" / V2: \"+msg.V2+\" / V3: \"+msg.V3;\n        }\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "858eedd0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Corte Energía",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 758,
        "layoutY" : 47
      },
      "configuration" : {
        "jsScript" : "return metadata.alarma == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "85933390-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Corte de Energía",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1131,
        "layoutY" : 71
      },
      "configuration" : {
        "alarmDetailsBuildJs" : "var details = {};\ndetails = metadata.alarmadetalle;\nreturn details;",
        "alarmType" : "Corte Energia"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "859863b0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Corte de Energía",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbClearAlarmNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 2229,
        "layoutY" : 676
      },
      "configuration" : {
        "jsScript" : "return metadata.ss_aSMSON == \"1\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "859b9800-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Enviar SMS",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 268,
        "layoutY" : 635
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "aDELAY", "aON", "aHISTERESIS", "aEMAIL", "aBOT", "aBOTON", "aBOTGROUP", "aSENSIBILIDAD", "aMUESTREO", "aSMSON", "aSMS" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false,
        "fetchTo" : "METADATA"
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "859fddc0-cc2f-11ee-a15d-5578c62b7072"
      },
      "name" : "Limites",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}